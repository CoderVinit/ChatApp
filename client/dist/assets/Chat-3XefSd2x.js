import{j as e,c as ne,u as $,r as t,d as oe,s as G,_ as C,e as _,l as ie,f as ae,h as le,i as ce,k as me,m as ue,n as de,S as N,g as pe,T as ge,I as fe,o as he}from"./index-Dm6jrkaa.js";import{b as xe}from"./index-DpHtcuSt.js";import{M as je,a as ye}from"./Menu-BqoZ4b2f.js";import{M as L,L as F}from"./MenuItem-msHtV5-r.js";import{M as T}from"./Tooltip-mdcBTkzG.js";import{c as y,T as V}from"./Typography-BNMws05L.js";import{m as ve,A as Me,N as B,S as O,a as D,b as Se}from"./AppLayout-DAALmdoM.js";import{h as Ce,F as Ae,B as be,u as Le,a as Fe}from"./Features-M4ODAUeT.js";import{R as Te}from"./RenderAttachments-CHbGAufO.js";import{M as P}from"./IconButton-CjltV93Y.js";import"./Modal-DKikbja4.js";import"./Avatar-BOgCjYz0.js";import"./AvatarCard-Nl53eBtE.js";import"./Toolbar-DFr84wlo.js";import"./Delete-Cwb7cZ6I.js";import"./Group-Bzil1lY3.js";import"./ExitToApp-oEY90qON.js";const ke=y(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),Ee=y(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),Re=y(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),Ve=y(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),we=y(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Ie=y(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile"),He=({anchorE1:s,chatId:f})=>{const{isFileMenu:a}=ne(n=>n.misc),i=$(),u=t.useRef(null),d=t.useRef(null),j=t.useRef(null),l=t.useRef(null),[h]=oe(),x=()=>{i(G(!1))},o=n=>{var m;(m=n.current)==null||m.click()},c=async(n,m)=>{const v=Array.from(n.target.files);if(v.length<=0)return;if(v.length>5)return C.error(`You can only send 5 ${m} at a time`);i(_(!0));const M=C.loading(`Uploading ${m}....`);x();try{const p=new FormData;p.append("chatId",f),v.forEach(A=>{p.append("files",A)}),(await h(p)).data?C.success(` ${m} send Successfully`,{id:M}):C.error(`Failed to send ${m}`,{id:M})}catch(p){C.error(p,{id:M})}finally{i(_(!1))}};return e.jsx(je,{anchorEl:s,open:a,onClose:x,children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(ye,{children:[e.jsxs(L,{onClick:()=>o(u),children:[e.jsx(T,{title:"Image",children:e.jsx(Re,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/jpeg,image/png,image/gif,image/jpg",style:{display:"none"},onChange:n=>c(n,"Images"),ref:u})]}),e.jsxs(L,{onClick:()=>o(d),children:[e.jsx(T,{title:"Audio",children:e.jsx(Ee,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:n=>c(n,"Audios"),ref:d})]}),e.jsxs(L,{onClick:()=>o(j),children:[e.jsx(T,{title:"Video",children:e.jsx(Ie,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Videos"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:n=>c(n,"Videos"),ref:j})]}),e.jsxs(L,{onClick:()=>o(l),children:[e.jsx(T,{title:"File",children:e.jsx(we,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Files"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:n=>c(n,"Files"),ref:l})]})]})})})},ze=({message:s,user:f})=>{const{sender:a,content:i,attachments:u=[],createdAt:d}=s,j=Ce(d).fromNow(),l=(a==null?void 0:a._id)===(f==null?void 0:f._id);return e.jsxs(ve.div,{initial:{opacity:0,x:"-100%"},whileInView:{opacity:1,x:0},style:{alignSelf:l?"flex-end":"flex-stasrt",color:"black",backgroundColor:"white",width:"fit-content",padding:"0.5rem",borderRadius:"5px"},children:[!l&&e.jsx(V,{color:ie,fontWeight:"600",variant:"caption",children:a.name}),i&&e.jsx(V,{children:i}),u.length>0&&u.map((h,x)=>{const o=h.url,c=Ae(o);return e.jsx(be,{children:e.jsx("a",{href:o,target:"_blank",rel:"noreferrer",download:!0,style:{color:"black"},children:Te(c,o)})},x)}),e.jsx(V,{variant:"caption",color:"text.secondary",children:j})]})},Ue=({chatId:s,user:f})=>{var I,H,z,U;const a=t.useRef(null),i=ae(),u=$(),d=t.useRef(null),j=le(),[l,h]=t.useState(""),[x,o]=t.useState([]),[c,n]=t.useState(1),[m,v]=t.useState(null),[M,p]=t.useState(!1),[w,A]=t.useState(!1),k=t.useRef(null),g=ce({chatId:s,skip:!s}),b=me({chatId:s,page:c}),{data:Y,setData:Q}=xe(a,(I=b.data)==null?void 0:I.totalPages,c,n,(H=b.data)==null?void 0:H.message),W=[{isError:g.isError,error:g.error},{isError:b.isError,error:b.error}],E=(U=(z=g==null?void 0:g.data)==null?void 0:z.chat)==null?void 0:U.members,X=r=>{r.preventDefault(),l.trim()&&(i.emit(B,{members:E,chatId:s,message:l}),h(""))};t.useEffect(()=>(u(ue(s)),()=>{o([]),Q([]),h(""),n(1)}),[s]);const q=r=>{h(r.target.value),M||(i.emit(O,{members:E,chatId:s}),p(!0)),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{i.emit(D,{members:E,chatId:s}),p(!1)},[2e3])};t.useEffect(()=>{d.current&&d.current.scrollIntoView({behavior:"smooth"})},[x]),t.useEffect(()=>{if(g.isError)return j("/")},[g.isError]);const J=t.useCallback(r=>{r.chatId===s&&o(S=>[...S,r.message])},[s]),K=t.useCallback(r=>{r.chatId===s&&A(!0)},[s]),Z=t.useCallback(r=>{r.chatId===s&&A(!1)},[s]),ee=r=>{u(G(!0)),v(r.currentTarget)},se=t.useCallback(r=>{if(r.chatId!==s)return;const S={content:r.message,sender:{_id:Math.random,name:"Admin"},chat:s,createdAt:new Date().toISOString()};o(re=>[...re,S])},[s]),te={[Se]:se,[B]:J,[O]:K,[D]:Z};Le(i,te),Fe(W);const R=[...Y,...x];return g.isLoading?e.jsx(de,{}):e.jsxs(e.Fragment,{children:[e.jsxs(N,{ref:a,boxSizing:"border-box",padding:"1rem",spacing:"1rem",bgcolor:pe,height:"90%",sx:{overflowX:"hidden",overflowY:"auto"},children:[R==null?void 0:R.map((r,S)=>e.jsx(ze,{message:r,user:f.data},S)),w&&e.jsx(ge,{}),e.jsx("div",{ref:d})]}),e.jsx("form",{style:{height:"10%"},onSubmit:X,children:e.jsxs(N,{direction:"row",alignItems:"center",height:"100%",padding:"1rem",position:"relative",children:[e.jsx(P,{sx:{position:"absolute",rotate:"30deg",left:"1.5rem"},onClick:ee,children:e.jsx(ke,{})}),e.jsx(fe,{placeholder:"Type your message here....",value:l,onChange:q}),e.jsx(P,{type:"submit",sx:{backgroundColor:he,color:"white",marginLeft:"1rem",padding:"0.5rem","&:hover":{backgroundColor:"error.dark"}},children:e.jsx(Ve,{})})]})}),e.jsx(He,{anchorE1:m,chatId:s})]})},ss=Me()(Ue);export{ss as default};
